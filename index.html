<!doctype html>
<html lang="">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Poem Visualizer</title>
   
</head>
<body style="background-color: black;">


        <div id="p5-sketch-holder"></div>





    //<script src="https://res.distal.me/matrix-js-sdk/browser-matrix.min.js"></script> 
    <script src="https://res.distal.me/p5-js/p5.min.js"></script> 
    <!-- <script>
        let client;

        
            
            attachToRoomEvents();
        

    
        function attachToRoomEvents() {

         client = matrix_js.createClient({
            baseUrl: "https://my.distal.me",
            accessToken:  "MDAxYWxvY2F0aW9uIG15LmRpc3RhbC5tZQowMDEzaWRlbnRpZmllciBrZXkKMDAxMGNpZCBnZW4gPSAxCjAwMjVjaWQgdXNlcl9pZCA9IEBkaXJrOm15LmRpc3RhbC5tZQowMDE2Y2lkIHR5cGUgPSBhY2Nlc3MKMDAyMWNpZCBub25jZSA9IGtTQEoraWlBa1RHcWN4QEIKMDAyZnNpZ25hdHVyZSAwegdfZx4R2FUXihTlDZg8_ji2Ihe77zCMnFrMj22edAo",
            userId: "@dirk:my.distal.me"
        });


        client.on("Room.timeline", function(event, room, toStartOfTimeline) {
            if (toStartOfTimeline) {
                return; // ignore paginated results
            }
            if (event.getType() !== "m.room.message") {
                return; // only care about messages
            }
            if(room.roomId == "!ueVURIhvRLFStLoLtC:my.distal.me") {
                P5GetsAMessageNotificationFromRoomEvent(room.name,event.getSender(),event.getContent().body);
            }
        });

        client.startClient();
        }


        
       
    </script> -->


    <script>



        


let alignSlider, cohesionSlider, separationSlider;
let xoff = 1.4;
let xoff2 = 5.6;
let xoff3 = 10.2;
var str = new String("");



function Boid(){
    this.location = createVector(random(width), random(height));
    this.velocity = p5.Vector.random2D();
    this.velocity.setMag(random(2, 4));
    this.acceleration = createVector();
    this.maxSpeed = 3;
    this.maxForce = 1;
    this.calcSpeed;

    this.update = function() {
      this.location.add(this.velocity);
      this.velocity.add(this.acceleration);
      this.velocity.limit(this.maxSpeed);
      this.acceleration.mult(0);
      this.calcSpeed = String(this.velocity.magSq());

    }

    this.display = function(boids) {
      //noStroke();

      color1 = color( map(this.calcSpeed,0,15,0,255), map(this.calcSpeed,0,15,0,255),map(this.calcSpeed,0,15,0,255),3);
      stroke(color1);
      strokeWeight(1);
      fill(color1);
      //console.log(this.velocity);
      
      rect(this.location.x,this.location.y, map(this.calcSpeed,0,3,200,400), map(this.calcSpeed,0,3,10,400));
    }

    this.edges = function() {
      if (this.location.x > width) {
        this.location.x = 0;
      } else if (this.location.x < 0) {
        this.location.x = width;
      }

      if (this.location.y > height) {
        this.location.y = 0;
      } else if (this.location.y < 0) {
        this.location.y = height;
      }
    }

    this.align = function(boids){
      let perceptionRadius = 250;
      let steering = createVector();
      let total = 0;

      for (let other of boids) {
        let d = dist(
          this.location.x,
          this.location.y,
          other.location.x,
          other.location.y
        );
        if (other != this && d < perceptionRadius) {
          steering.add(other.velocity);
          total++;
        }
      }

      if (total > 0) {
        steering.div(total);
        steering.setMag(this.maxSpeed);
        steering.sub(this.velocity);
        steering.limit(this.maxForce);
      }
      return steering;

    }

    this.separation = function(boids) {
        let perceptionRadius = 250;
        let steering = createVector();
        let total = 0;
        for (let other of boids) {
          let d = dist(
            this.location.x,
            this.location.y,
            other.location.x,
            other.location.y
          );
          if (other != this && d < perceptionRadius) {
            let diff = p5.Vector.sub(this.location, other.location);
            diff.div(d * d);
            steering.add(diff);
            total++;
          }
        }
        if (total > 0) {
          steering.div(total);
          steering.setMag(this.maxSpeed);
          steering.sub(this.velocity);
          steering.limit(this.maxForce);
        }
        return steering;
    }

    this.cohesion = function(boids){
        let perceptionRadius = 300;
        let steering = createVector();
        let total = 0;
        for (let other of boids) {
          let d = dist(
            this.location.x,
            this.location.y,
            other.location.x,
            other.location.y
          );
          if (other != this && d < perceptionRadius) {
            steering.add(other.location);
            total++;
          }
        }
        if (total > 0) {
          steering.div(total);
          steering.sub(this.location);
          steering.setMag(this.maxSpeed);
          steering.sub(this.velocity);
          steering.limit(this.maxForce);
        }
        return steering;

    }
    this.flock = function(boids){

        let cohesion = this.cohesion(boids);
        let alignment = this.align(boids);
        let separation = this.separation(boids);

        alignment.mult(alignSlider2);
        cohesion.mult(cohesionSlider2);
        separation.mult(separationSlider2);

        this.acceleration.add(alignment);
        this.acceleration.add(cohesion);
        this.acceleration.add(separation);
    }
  }


  let boids = [];

  function setup() {
    createCanvas(800, 800);
    background(0);
    noStroke();



    // alignSlider = createSlider(0, 2, 1, 0.1);
    // alignSlider.position(10, height+20);
    //
    // cohesionSlider = createSlider(0, 2, 1, 0.1);
    // cohesionSlider.position(10, height+40);
    //
    // separationSlider = createSlider(0, 2, 1, 0.1);
    // separationSlider.position(10, height+60);

    for (let i = 0; i < 10; i++) {
      boids[i] = new Boid();
    }
    
  }

  function draw() {
    blendMode(DARKEST);
    background('rgba(0,0,0,0.02)');
    
    
    filter(POSTERIZE,60);
    blendMode(ADD);
    xoff = xoff + 0.04;
    xoff2 = xoff2 + 0.035;
    xoff3 = xoff3 + 0.032;

    let n = noise(xoff);
    let n2 = noise(xoff2);
    let n3 = noise(xoff3);

    alignSlider2 = map(n,0,1,0,3);
    cohesionSlider2 = map(n2,0,1,0,2);
    separationSlider2 =  map(n3,0,1,0,2);

    for (let i = 0; i < boids.length; i++) {

      
      background('rgba(0,0,0,0.1)');
      
      boids[i].edges();
      boids[i].update();
      boids[i].flock(boids);
      boids[i].display(boids);
      
    }
    
  //filter(DILATE);
  
  }
 
  function keyPressed(){

  


    

}

// function P5GetsAMessageNotificationFromRoomEvent(roomName,sender,message) {
//             console.log(
//                 "in the room: " 
//                 + roomName + 
//                 " a message was posted by " 
//                 + sender + 
//                 "with the content: "
//                 + message
//             );
//             str = message;
//             fill(0);
//             //rect(0,0,170,20)
//             fill(255);
//             textSize(10);
//             //text("current poem position: " + str + int(random(0,9))+ int(random(0,9))+int(random(0,9))+int(random(0,9)), 10, 10);
//         }


    </script>


</body>
</html>